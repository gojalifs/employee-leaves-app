import{R as y,j as e,S as N}from"./app-hpof5UXI.js";import{B as j}from"./button-GmsC7mJ2.js";import{P as f,a as _,f as v,C as b,b as w,c as S}from"./popover-D4MAYD0p.js";import{u as L,F as q,a as d,b as i,c,d as p,e as u,f as m,s as R,z as l}from"./index-C6muke0y.js";import{I as D}from"./input-hkdoHqWH.js";import{S as V,a as P,b as A,c as E,d as k}from"./select-nCYOwixR.js";import{c as F}from"./utils-YvIYhwMp.js";import{t as g}from"./index-D00Qqd_r.js";import"./createLucideIcon-DGoynV5J.js";import"./index-Br8jnGSO.js";import"./index-DO7uKY43.js";import"./index-BDFscTOR.js";import"./index-DUJvO9Ti.js";const I=l.object({leave_type_id:l.string().nonempty(),start_date:l.date().optional(),end_date:l.date().optional(),reason:l.string().nonempty(),note:l.string().optional()});function $({leave:r}){const s=L({resolver:R(I),defaultValues:{leave_type_id:r.leave_type.id.toString(),start_date:new Date(r.start_date)||void 0,end_date:new Date(r.end_date)||void 0,reason:r.reason,note:r.note||""}}),[a,n]=y.useState(void 0),[x,C]=y.useState(void 0);return console.log(new Date(r.start_date)),e.jsxs("div",{className:"mx-auto max-w-2xl rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("h1",{className:"mb-6 text-2xl font-bold",children:["Add New ",a?a.name:"Leave"," Request"]}),e.jsx(q,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(M),className:"space-y-4",children:[e.jsx(d,{control:s.control,name:"leave_type_id",render:({field:t})=>e.jsxs(i,{children:[e.jsx(c,{htmlFor:"leave_type_id",children:"Leave Type"}),e.jsx(p,{children:e.jsxs(V,{value:t.value,disabled:!0,onValueChange:o=>{t.onChange(o),n(r.leave_type),C(r)},children:[e.jsx(P,{className:"w-full rounded-md border border-gray-500 px-4 py-2",children:e.jsx(A,{placeholder:"Select Leave Type"})}),e.jsx(E,{children:e.jsx(k,{value:r.leave_type.id.toString(),children:r.leave_type.name},r.id)})]})}),e.jsx(u,{children:"Leave Type"}),e.jsx(m,{})]})}),e.jsx(d,{control:s.control,name:"start_date",render:({field:t})=>e.jsxs(i,{children:[e.jsx(c,{htmlFor:"start_date",children:"Pick Start Date"}),e.jsxs(f,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(j,{id:"date",variant:"outline",disabled:!0,className:F("w-full rounded-md border border-gray-500 px-4 py-2 disabled:cursor-not-allowed",!t.value&&"text-muted-foreground"),children:[e.jsx(b,{}),t.value?v(t.value,"LLL dd, y"):e.jsx("span",{children:"Select a date"})]})}),e.jsx(w,{className:"w-auto p-0",align:"start",children:e.jsx(S,{mode:"single",selected:t.value,onSelect:o=>{t.onChange(o),s.setValue("end_date",o&&(a==null?void 0:a.fix_duration)==1?new Date(o.getTime()+((a==null?void 0:a.max_quantity)??0)*24*60*60*1e3):void 0)},initialFocus:!0,numberOfMonths:1,disabled:o=>o.getDay()===0||o.getDay()===6||o<new Date})})]}),e.jsx(u,{children:"Select start date for leave request"}),e.jsx(m,{})]})}),e.jsx(d,{control:s.control,name:"end_date",render:({field:t})=>{var o;return e.jsxs(i,{children:[e.jsx(c,{htmlFor:"end_date",children:"Pick End Date"}),e.jsxs(f,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(j,{id:"date",variant:"outline",disabled:!0,className:F("w-full rounded-md border border-gray-500 px-4 py-2",!t.value&&"text-muted-foreground"),children:[e.jsx(b,{}),t.value?v(t.value,"LLL dd, y"):e.jsx("span",{children:"Select a date"})]})}),e.jsx(w,{className:"w-auto p-0",align:"start",children:e.jsx(S,{mode:"single",selected:t.value,onSelect:t.onChange,initialFocus:!0,fromDate:s.getValues("start_date"),toDate:(a==null?void 0:a.unit)==="work day"?B(s.getValues("start_date"),(x==null?void 0:x.remaining_leaves)??0):new Date((((o=s.getValues("start_date"))==null?void 0:o.getTime())??0)+((a==null?void 0:a.max_quantity)??0)*24*60*60*1e3),numberOfMonths:1,disabled:h=>h.getDay()===0||h.getDay()===6||h<new Date})})]}),e.jsx(u,{children:"Select end date for leave request"}),e.jsx(m,{})]})}}),e.jsx(d,{control:s.control,name:"reason",render:({field:t})=>e.jsxs(i,{children:[e.jsx(c,{htmlFor:"reason",children:"Reason"}),e.jsx(p,{children:e.jsx(D,{...t,placeholder:"Reason",disabled:!0,className:"w-full rounded-md border px-4 py-2"})}),e.jsx(u,{children:"Reason for leave request"}),e.jsx(m,{})]})}),e.jsx(d,{control:s.control,name:"note",render:({field:t})=>e.jsxs(i,{children:[e.jsx(c,{htmlFor:"note",children:"Note"}),e.jsx(p,{children:e.jsx(D,{...t,placeholder:"Note",disabled:!0,className:"w-full rounded-md border px-4 py-2"})}),e.jsx(u,{children:"Additional Note for leave request"}),e.jsx(m,{})]})})]})}),e.jsx(j,{variant:"destructive",onClick:()=>{confirm("Are you sure you want to cancel your leave request?")&&N.post(route("request.cancel",{id:r.id}),void 0,{onSuccess:()=>{g.success("Leave request cancelled successfully")},onError:t=>{console.log(t),g.error(t.msg||"An error occurred")}})},className:"my-2 w-full",children:"Cancel Leave Request"})]})}function M(r){console.log(r),N.post(route("request.cancel"),r,{onError:s=>{console.log(s),g.error("Failed to create leave request")}})}function B(r,s){if(!r)return new Date;let a=0,n=new Date(r);for(;a<s-1;)n.setDate(n.getDate()+1),n.getDay()!==0&&n.getDay()!==6&&a++;return n}export{$ as default};
