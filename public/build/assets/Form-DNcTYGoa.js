import{R as g,j as e,S as V}from"./app-hpof5UXI.js";import{B as f}from"./button-GmsC7mJ2.js";import{P as _,a as y,f as v,C as S,b as w,c as D}from"./popover-D4MAYD0p.js";import{u as I,F as P,a as i,b as c,c as m,d as b,e as u,f as x,s as M,z as d}from"./index-C6muke0y.js";import{I as F}from"./input-hkdoHqWH.js";import{S as k,a as A,b as E,c as z,d as B}from"./select-nCYOwixR.js";import{c as N}from"./utils-YvIYhwMp.js";import{t as C}from"./index-D00Qqd_r.js";import{c as O}from"./createLucideIcon-DGoynV5J.js";import"./index-Br8jnGSO.js";import"./index-DO7uKY43.js";import"./index-BDFscTOR.js";import"./index-DUJvO9Ti.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],G=O("LoaderCircle",U),H=d.object({leave_type_id:d.string().nonempty(),start_date:d.date().optional(),end_date:d.date().optional(),reason:d.string().nonempty(),note:d.string().optional()});function oe({leaves:l}){const s=I({resolver:M(H),defaultValues:{leave_type_id:"",start_date:void 0,end_date:void 0,reason:"",note:""}}),[r,n]=g.useState(void 0),[h,L]=g.useState(void 0),[j,p]=g.useState(!1),q=async a=>{p(!0);try{await V.post(route("request.store"),a,{onError:t=>{C.error("Failed to create leave request"),console.error(t)},onFinish:()=>{p(!1)}})}catch(t){console.error(t),C.error("Unexpected error"),p(!1)}};return e.jsxs("div",{className:"mx-auto max-w-2xl rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("h1",{className:"mb-6 text-2xl font-bold",children:["Add New ",r?r.name:"Leave"," Request"]}),e.jsx(P,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(q),className:"space-y-4",children:[e.jsx(i,{control:s.control,name:"leave_type_id",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{htmlFor:"leave_type_id",children:"Leave Type"}),e.jsx(b,{children:e.jsxs(k,{value:a.value,onValueChange:t=>{a.onChange(t);const o=l.find(R=>R.leave_type.id.toString()===t);n(o==null?void 0:o.leave_type),L(o),console.log((o==null?void 0:o.remaining_leaves)??"d")},children:[e.jsx(A,{className:"w-full rounded-md border border-gray-500 px-4 py-2",children:e.jsx(E,{placeholder:"Select Leave Type"})}),e.jsx(z,{children:l.map(t=>e.jsx(B,{value:t.leave_type.id.toString(),children:t.leave_type.name},t.id))})]})}),e.jsx(u,{children:"Leave Type"}),e.jsx(x,{})]})}),e.jsx(i,{control:s.control,name:"start_date",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{htmlFor:"start_date",children:"Pick Start Date"}),e.jsxs(_,{children:[e.jsx(y,{asChild:!0,children:e.jsxs(f,{id:"date",variant:"outline",className:N("w-full rounded-md border border-gray-500 px-4 py-2",!a.value&&"text-muted-foreground"),children:[e.jsx(S,{}),a.value?v(a.value,"LLL dd, y"):e.jsx("span",{children:"Select a date"})]})}),e.jsx(w,{className:"w-auto p-0",align:"start",children:e.jsx(D,{mode:"single",selected:a.value,onSelect:t=>{a.onChange(t),s.setValue("end_date",t&&(r==null?void 0:r.fix_duration)==1?new Date(t.getTime()+((r==null?void 0:r.max_quantity)??0)*24*60*60*1e3):void 0)},initialFocus:!0,numberOfMonths:1,disabled:t=>t.getDay()===0||t.getDay()===6||t<new Date})})]}),e.jsx(u,{children:"Select start date for leave request"}),e.jsx(x,{})]})}),e.jsx(i,{control:s.control,name:"end_date",render:({field:a})=>{var t;return e.jsxs(c,{children:[e.jsx(m,{htmlFor:"end_date",children:"Pick End Date"}),e.jsxs(_,{children:[e.jsx(y,{asChild:!0,children:e.jsxs(f,{id:"date",variant:"outline",disabled:(r==null?void 0:r.fix_duration)==1,className:N("w-full rounded-md border border-gray-500 px-4 py-2",!a.value&&"text-muted-foreground"),children:[e.jsx(S,{}),a.value?v(a.value,"LLL dd, y"):e.jsx("span",{children:"Select a date"})]})}),e.jsx(w,{className:"w-auto p-0",align:"start",children:e.jsx(D,{mode:"single",selected:a.value,onSelect:a.onChange,initialFocus:!0,fromDate:s.getValues("start_date"),toDate:(r==null?void 0:r.unit)==="work day"?J(s.getValues("start_date"),(h==null?void 0:h.remaining_leaves)??0):new Date((((t=s.getValues("start_date"))==null?void 0:t.getTime())??0)+((r==null?void 0:r.max_quantity)??0)*24*60*60*1e3),numberOfMonths:1,disabled:o=>o.getDay()===0||o.getDay()===6||o<new Date})})]}),e.jsx(u,{children:"Select end date for leave request"}),e.jsx(x,{})]})}}),e.jsx(i,{control:s.control,name:"reason",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{htmlFor:"reason",children:"Reason"}),e.jsx(b,{children:e.jsx(F,{...a,placeholder:"Reason",className:"w-full rounded-md border px-4 py-2"})}),e.jsx(u,{children:"Reason for leave request"}),e.jsx(x,{})]})}),e.jsx(i,{control:s.control,name:"note",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{htmlFor:"note",children:"Note"}),e.jsx(b,{children:e.jsx(F,{...a,placeholder:"Note",className:"w-full rounded-md border px-4 py-2"})}),e.jsx(u,{children:"Additional Note for leave request"}),e.jsx(x,{})]})}),e.jsxs(f,{type:"submit",className:"w-full rounded-md bg-blue-500 py-2 text-white hover:bg-blue-600",disabled:j,children:[j&&e.jsx(G,{className:"h-5 w-5 animate-spin"}),j?"Submitting...":"Create Request"]})]})})]})}function J(l,s){if(!l)return new Date;let r=0,n=new Date(l);for(;r<s-1;)n.setDate(n.getDate()+1),n.getDay()!==0&&n.getDay()!==6&&r++;return n}export{oe as default};
